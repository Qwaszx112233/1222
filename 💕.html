<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no"
  />
  <title>‚ù§Ô∏è Love Number Puzzle ‚Äî –¥–ª—è –∫–æ—Ö–∞–Ω–æ—ó ‚ù§Ô∏è</title>

  <style>
    :root {
      --primary-color: #e91e63;
      --secondary-color: #ff4081;
      --accent-color: #f8bbd9;
      --bg-color: #fff5f7;
      --text-color: #880e4f;
      --white: #ffffff;
      --shadow: 0 4px 15px rgba(233, 30, 99, 0.18);
      --cell-color: #ffeef2;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #fff5f7 0%, #ffeef2 100%);
      min-height: 100vh;
      width: 100vw;
      overflow: hidden;
      touch-action: manipulation;
      color: var(--text-color);
    }

    .screen {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .screen.hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(10px);
    }

    /* Floating hearts */
    .floating-hearts {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
    }

    .floating-heart {
      position: absolute;
      font-size: 1rem;
      opacity: 0.12;
      animation: floatAround 14s linear infinite;
    }

    @keyframes floatAround {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(60px, 80px) rotate(90deg);
      }
      50% {
        transform: translate(30px, 150px) rotate(180deg);
      }
      75% {
        transform: translate(-50px, 120px) rotate(270deg);
      }
      100% {
        transform: translate(0, 0) rotate(360deg);
      }
    }

    /* Main menu */
    .main-menu {
      text-align: center;
    }

    .game-title {
      font-size: clamp(2rem, 8vw, 2.8rem);
      font-weight: 900;
      color: var(--primary-color);
      margin-bottom: 18px;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: heartbeat 2.4s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%,
      100% {
        transform: scale(1);
      }
      15% {
        transform: scale(1.07);
      }
      30% {
        transform: scale(0.98);
      }
      45% {
        transform: scale(1.05);
      }
      60% {
        transform: scale(1);
      }
    }

    .subtitle {
      max-width: 320px;
      font-size: 0.95rem;
      margin-bottom: 22px;
      line-height: 1.4;
    }

    .menu-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 280px;
    }

    .menu-btn {
      padding: 14px 18px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(
        45deg,
        var(--primary-color),
        var(--secondary-color)
      );
      color: #fff;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .menu-btn.secondary {
      background: #fff;
      color: var(--primary-color);
      border: 2px solid var(--accent-color);
    }

    .menu-btn:active {
      transform: scale(0.96);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
    }

    .menu-features {
      margin-top: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      max-width: 280px;
    }

    .feature-item {
      padding: 10px 6px;
      border-radius: 12px;
      background: #fff;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: var(--shadow);
    }

    /* Game screen */
    .game-screen {
      justify-content: flex-start;
      padding: 8px 10px 10px;
    }

    .game-header-row {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .home-btn {
      padding: 7px 10px;
      border-radius: 10px;
      border: 2px solid var(--accent-color);
      background: #fff;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: var(--shadow);
    }

    .header-text {
      flex: 1;
      text-align: center;
      font-weight: 700;
      font-size: 0.95rem;
    }

    .goal-box {
      width: 100%;
      margin-top: 2px;
      padding: 6px 8px;
      border-radius: 10px;
      background: #fff;
      border: 2px solid var(--accent-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 700;
      box-shadow: var(--shadow);
    }

    .xp-wrap {
      width: 100%;
      margin: 8px 0 4px;
    }

    .xp-label {
      font-size: 0.7rem;
      margin-bottom: 2px;
      text-align: center;
      font-weight: 600;
    }

    .xp-bar {
      position: relative;
      height: 12px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      background: #ffeef2;
      overflow: hidden;
    }

    .xp-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(
        45deg,
        var(--primary-color),
        var(--secondary-color)
      );
      transition: width 0.35s ease;
    }

    .xp-text {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      font-weight: 700;
      color: var(--text-color);
    }

    .bonuses {
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }

    .bonus-btn {
      min-width: 78px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 2px solid var(--accent-color);
      background: var(--cell-color);
      font-size: 0.75rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 3px;
      transition: transform 0.12s ease, background 0.12s ease,
        color 0.12s ease;
      box-shadow: var(--shadow);
    }

    .bonus-btn:active:not(:disabled) {
      transform: scale(0.95);
    }

    .bonus-btn.disabled,
    .bonus-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    .bonus-btn.active {
      background: var(--primary-color);
      color: #fff;
    }

    .bonus-cost {
      font-size: 0.65rem;
      font-weight: 800;
      color: var(--primary-color);
    }

    .game-content {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      margin-top: 4px;
      min-height: 0;
    }

    .grid-container {
      flex: 1;
      min-height: 0;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(8, 1fr);
      gap: 2px;
      width: 100%;
      max-width: 420px;
      height: 100%;
      max-height: 100%;
      padding: 6px;
      border-radius: 14px;
      background: #fff;
      box-shadow: var(--shadow);
      touch-action: none;
      user-select: none;
    }

    .cell {
      position: relative;
      border-radius: 9px;
      background: var(--cell-color);
      box-shadow: 0 1px 3px rgba(233, 30, 99, 0.2);
      overflow: hidden;
      border: 1px solid transparent;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        border-color 0.12s ease, opacity 0.12s ease;
    }

    .cell::before {
      content: "";
      display: block;
      padding-top: 100%;
    }

    .cell-inner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(0.8rem, 2.4vw, 1rem);
      font-weight: 800;
      color: var(--text-color);
      pointer-events: none;
      transition: transform 0.12s ease, background 0.12s ease,
        color 0.12s ease;
    }

    .cell.selected {
      transform: scale(0.96);
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 2px rgba(255, 64, 129, 0.45);
    }

    .cell.selected .cell-inner {
      background: var(--secondary-color);
      color: #fff;
      border-radius: 7px;
    }

    .cell.merged .cell-inner {
      background: var(--primary-color);
      color: #fff;
      border-radius: 7px;
      animation: pop 0.22s ease;
    }

    .cell.popping {
      animation: bubbleOut 0.25s ease forwards;
    }

    @keyframes pop {
      0% {
        transform: scale(1.2);
        opacity: 0.7;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes bubbleOut {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(0);
        opacity: 0;
      }
    }

    /* Number-specific background colors */
    .cell[data-number="2"] {
      background: #ffdee7;
    }
    .cell[data-number="4"] {
      background: #ffe6aa;
    }
    .cell[data-number="8"] {
      background: #d8ffd2;
    }
    .cell[data-number="16"] {
      background: #d5f1ff;
    }
    .cell[data-number="32"] {
      background: #f0d5ff;
    }
    .cell[data-number="64"] {
      background: #ffd6bf;
    }
    .cell[data-number="128"] {
      background: #f6f0b8;
    }
    .cell[data-number="256"] {
      background: #eedcff;
    }
    .cell[data-number="512"] {
      background: #cfe9ff;
    }
    .cell[data-number="1024"] {
      background: #ffe1c4;
    }
    .cell[data-number="2048"] {
      background: #f4d6ff;
    }
    .cell[data-number="4096"] {
      background: #c7f5c4;
    }
    .cell[data-number="8192"] {
      background: #ffb9b9;
    }

    /* Floating love messages */
    .love-bubble {
      position: absolute;
      max-width: 80%;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.96);
      border: 2px solid var(--accent-color);
      box-shadow: var(--shadow);
      font-size: 0.8rem;
      font-weight: 700;
      text-align: center;
      animation: loveFloat 1.9s ease-out forwards;
      pointer-events: none;
    }

    @keyframes loveFloat {
      0% {
        opacity: 0;
        transform: translateY(10px) scale(0.9);
      }
      20% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      80% {
        opacity: 1;
        transform: translateY(-8px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-18px) scale(0.97);
      }
    }

    /* Preview bubble */
    .preview-bubble {
      position: absolute;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid var(--accent-color);
      font-size: 0.75rem;
      font-weight: 700;
      pointer-events: none;
      transform: translate(-50%, -130%);
      white-space: nowrap;
      box-shadow: var(--shadow);
      opacity: 0;
      transition: opacity 0.1s ease;
    }

    /* Victory overlay */
    .victory-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255, 245, 247, 0.96);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .victory-overlay.hidden {
      display: none;
    }

    .victory-content {
      background: #fff;
      border-radius: 20px;
      padding: 26px 22px;
      box-shadow: 0 18px 40px rgba(233, 30, 99, 0.35);
      text-align: center;
      max-width: 90%;
    }

    .victory-title {
      font-size: 1.7rem;
      color: var(--primary-color);
      margin-bottom: 10px;
      font-weight: 900;
    }

    .victory-text {
      font-size: 0.95rem;
      margin-bottom: 18px;
    }

    /* Settings & About */
    .settings-screen {
      padding: 20px 18px;
      text-align: center;
    }

    .settings-title {
      font-size: 1.6rem;
      margin-bottom: 16px;
      color: var(--primary-color);
      font-weight: 800;
    }

    .settings-options {
      max-width: 320px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .setting-item {
      background: #fff;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      text-align: left;
    }

    .setting-label {
      font-weight: 700;
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .setting-control {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      font-size: 0.9rem;
      background: #fff;
    }

    .back-btn-menu {
      margin-top: 16px;
    }

    @media (max-height: 620px) {
      .game-screen {
        padding-top: 6px;
      }
      .grid {
        padding: 4px;
      }
    }

    @media (max-width: 340px) {
      .menu-buttons {
        max-width: 250px;
      }
      .bonus-btn {
        min-width: 68px;
        font-size: 0.7rem;
      }
    }
  </style>
</head>

<body>
  <!-- background hearts -->
  <div class="floating-hearts" id="floatingHearts"></div>

  <!-- victory overlay -->
  <div class="victory-overlay hidden" id="victoryOverlay">
    <div class="victory-content">
      <div class="victory-title">üéâ –ö–æ—Ö–∞–Ω–∞, —Ç–∏ —Ü–µ –∑—Ä–æ–±–∏–ª–∞! üéâ</div>
      <div class="victory-text" id="victoryText">
        –¢–∏ –ø—Ä–æ–π—à–ª–∞ –≤—Å—ñ —Ä—ñ–≤–Ω—ñ —Ü—ñ—î—ó –º–∞–ª–µ–Ω—å–∫–æ—ó –≥—Ä–∏, –∞–ª–µ –º–æ—î –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ –Ω–µ –º–∞—î –º–µ–∂ üíñ
      </div>
      <div class="menu-buttons" style="margin-top:8px;">
        <button class="menu-btn" id="playAgainBtn">üîÑ –ü–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
        <button class="menu-btn secondary" id="backToMenuBtn">üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</button>
      </div>
    </div>
  </div>

  <!-- main menu -->
  <div class="screen main-menu" id="mainMenuScreen">
    <div class="game-title">‚ù§Ô∏è Love Puzzle –¥–ª—è –º–æ—î—ó –¥—Ä—É–∂–∏–Ω–∏ ‚ù§Ô∏è</div>
    <div class="subtitle">
      –¶–µ –Ω–µ–≤–µ–ª–∏—á–∫–∞ –≥—Ä–∞, –∞–ª–µ –≤ –∫–æ–∂–Ω—ñ–π –∫–ª—ñ—Ç–∏–Ω—Ü—ñ —Ç—É—Ç ‚Äî —á–∞—Å—Ç–∏–Ω–∫–∞ –º–æ–≥–æ –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ.
    </div>
    <div class="menu-buttons">
      <button class="menu-btn" id="playBtn">üéÆ –ü–æ—á–∞—Ç–∏ –≥—Ä–∞—Ç–∏</button>
      <button class="menu-btn secondary" id="settingsBtn">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
      <button class="menu-btn secondary" id="aboutBtn">‚ÑπÔ∏è –ü—Ä–æ –≥—Ä—É</button>
    </div>
    <div class="menu-features">
      <div class="feature-item">üíñ –Ø —Ç–µ–±–µ –ª—é–±–ª—é</div>
      <div class="feature-item">—Ç–∏ ‚Äî –º–æ—î —Å–æ–Ω–µ—á–∫–æ</div>
      <div class="feature-item">—Ç–∏ –º–æ—è —Ä–∞–¥—ñ—Å—Ç—å</div>
      <div class="feature-item">—Ç–∏ –º–æ—î –Ω–∞–∑–∞–≤–∂–¥–∏ üíï</div>
    </div>
  </div>

  <!-- game screen -->
  <div class="screen game-screen hidden" id="gameScreen">
    <div class="game-header-row">
      <button class="home-btn" id="homeBtn">üè†</button>
      <div class="header-text">–°–æ–Ω–µ—á–∫–æ, —è —Ç–µ–±–µ –∫–æ—Ö–∞—é ‚ù§Ô∏è</div>
    </div>

    <div class="goal-box">
      üéØ –¶—ñ–ª—å —Ä—ñ–≤–Ω—è: <span id="targetValue">64</span>
    </div>

    <div class="xp-wrap">
      <div class="xp-label">–®–∫–∞–ª–∞ –Ω–∞—à–æ–≥–æ –∫–æ—Ö–∞–Ω–Ω—è ‚ú®</div>
      <div class="xp-bar">
        <div class="xp-inner" id="xpBar"></div>
        <div class="xp-text" id="xpText">0/10</div>
      </div>
    </div>

    <div class="bonuses">
      <button class="bonus-btn" id="bonus-destroy">
        üíñ –†–æ–∑–±–∏—Ç–∏ <span class="bonus-cost">5</span>
      </button>
      <button class="bonus-btn" id="bonus-shuffle">
        üîÑ –ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏ <span class="bonus-cost">10</span>
      </button>
      <button class="bonus-btn" id="bonus-explosion">
        üí• –í–∏–±—É—Ö 3√ó3 <span class="bonus-cost">20</span>
      </button>
    </div>

    <div class="game-content">
      <div class="grid-container">
        <div class="grid" id="grid"></div>
        <div class="preview-bubble" id="previewBubble">= 0</div>
      </div>
    </div>
  </div>

  <!-- settings screen -->
  <div class="screen settings-screen hidden" id="settingsScreen">
    <div class="settings-title">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚öôÔ∏è</div>
    <div class="settings-options">
      <div class="setting-item">
        <span class="setting-label">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</span>
        <select class="setting-control" id="difficultySelect">
          <option value="easy">–õ–µ–≥–∫–∞</option>
          <option value="medium" selected>–°–µ—Ä–µ–¥–Ω—è</option>
          <option value="hard">–°–∫–ª–∞–¥–Ω–∞</option>
        </select>
      </div>
      <div class="setting-item">
        <span class="setting-label">–ê–Ω—ñ–º–∞—Ü—ñ—ó:</span>
        <select class="setting-control" id="animationSelect">
          <option value="on" selected>–£–≤—ñ–º–∫–Ω–µ–Ω—ñ</option>
          <option value="off">–í–∏–º–∫–Ω–µ–Ω—ñ</option>
        </select>
      </div>
      <div class="setting-item">
        <span class="setting-label">–õ—é–±–æ–≤–Ω—ñ —Ñ—Ä–∞–∑–∏:</span>
        <select class="setting-control" id="phrasesSelect">
          <option value="normal" selected>–ó–≤–∏—á–∞–π–Ω–∏–π —Ä–µ–∂–∏–º</option>
          <option value="more">–ë—ñ–ª—å—à–µ —Ñ—Ä–∞–∑ üíï</option>
        </select>
      </div>
    </div>
    <div class="menu-buttons back-btn-menu">
      <button class="menu-btn" id="saveSettingsBtn">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button class="menu-btn secondary" id="backFromSettingsBtn">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
  </div>

  <!-- about screen -->
  <div class="screen settings-screen hidden" id="aboutScreen">
    <div class="settings-title">–ü—Ä–æ –≥—Ä—É ‚ÑπÔ∏è</div>
    <div class="settings-options">
      <div class="setting-item" style="text-align:center;">
        <p style="margin-bottom:10px;font-weight:700;">
          –¶—è –≥—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —è–∫ –º–∞–ª–µ–Ω—å–∫–∏–π –ø–æ–¥–∞—Ä—É–Ω–æ–∫ –∫–æ—Ö–∞–Ω—ñ–π –¥—Ä—É–∂–∏–Ω—ñ üíñ
        </p>
        <p style="font-size:0.9rem;line-height:1.4;">
          –û–±‚Äô—î–¥–Ω—É–π —á–∏—Å–ª–∞ –¥–æ—Ç–∏–∫–æ–º, –∑–±–∏—Ä–∞–π –±—ñ–ª—å—à—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞–π
          –Ω–æ–≤—ñ —Ä—ñ–≤–Ω—ñ –Ω–∞—à–æ–≥–æ –∫–æ—Ö–∞–Ω–Ω—è. –ö–æ–∂–Ω–∞ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è ‚Äî —â–µ –æ–¥–∏–Ω –∫—Ä–æ–∫ –¥–æ –≤–µ–ª–∏–∫–æ–≥–æ –ø–æ—á—É—Ç—Ç—è.
        </p>
        <p style="margin-top:10px;font-size:0.9rem;line-height:1.4;">
          –ù—ñ—è–∫–∏—Ö —Ç–∞–π–º–µ—Ä—ñ–≤, –Ω—ñ—è–∫–æ–≥–æ –ø—Ä–∏–º—É—Å—É ‚Äî —Ç—ñ–ª—å–∫–∏ —Ç–∏, —á–∏—Å–ª–∞ —Ç–∞ –º–æ—î –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ.
        </p>
      </div>
    </div>
    <div class="menu-buttons back-btn-menu">
      <button class="menu-btn secondary" id="backFromAboutBtn">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
  </div>

  <script>
    class LoveNumberPuzzle {
      constructor() {
        this.GRID_W = 5;
        this.GRID_H = 8;

        this.levels = this.generateLevels(40);
        this.MAX_LEVEL = this.levels.length;

        this.currentLevel = 0;
        this.grid = [];
        this.selected = [];
        this.chainNumbers = [];
        this.isDragging = false;
        this.activeBonus = null;

        this.xp = 0;
        this.xpToNext = 10;
        this.gameState = "playing";

        this.animationEnabled = true;
        this.phrasesMode = "normal";

        this.bonusCosts = {
          destroy: 5,
          shuffle: 10,
          explosion: 20,
        };

        this.loveMessages = [
          "–¢–∏ ‚Äî –º–æ—î —Å–æ–Ω–µ—á–∫–æ, —â–æ –∑—ñ–≥—Ä—ñ–≤–∞—î –∫–æ–∂–µ–Ω –¥–µ–Ω—å ‚òÄÔ∏è",
          "–ó —Ç–æ–±–æ—é –Ω–∞–≤—ñ—Ç—å –∑–≤–∏—á–∞–π–Ω–∏–π –¥–µ–Ω—å –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ —Å–≤—è—Ç–æ üéâ",
          "–Ø –∫–æ—Ö–∞—é —Ç–µ–±–µ –¥–æ –±–µ–∑–∫—ñ–Ω–µ—á–Ω–æ—Å—Ç—ñ –π –Ω–∞–∑–∞–¥ ‚ôæÔ∏è",
          "–¢–≤–æ—ó –æ—á—ñ ‚Äî –º—ñ–π —É–ª—é–±–ª–µ–Ω–∏–π –≤—Å–µ—Å–≤—ñ—Ç ‚ú®",
          "–¢–∏ —Ä–æ–±–∏—à –º–æ—î —Å–µ—Ä—Ü–µ —Å–ø–æ–∫—ñ–π–Ω–∏–º —ñ —â–∞—Å–ª–∏–≤–∏–º üíó",
          "–ö–æ–∂–µ–Ω —Ç–≤—ñ–π —Å–º—ñ—Ö ‚Äî —è–∫ –º–∞–ª–µ–Ω—å–∫–µ –¥–∏–≤–æ –¥–ª—è –º–µ–Ω–µ üå∏",
          "–ú–µ–Ω—ñ –ø–æ—â–∞—Å—Ç–∏–ª–æ, —â–æ —Ç–∏ ‚Äî —Å–∞–º–µ —Ç–∏ ü•∞",
          "–•–æ—á—É —Ç—Ä–∏–º–∞—Ç–∏ —Ç–µ–±–µ –∑–∞ —Ä—É–∫—É –≤—Å–µ –∂–∏—Ç—Ç—è ü§ù",
          "–¢–∏ –Ω–∞–π–Ω—ñ–∂–Ω—ñ—à–µ, —â–æ —É –º–µ–Ω–µ —î üíï",
          "–¢–∏ ‚Äî –º–æ—è —Ç–∏—Ö–∞ –≥–∞–≤–∞–Ω—å —É –±—É—Ä—Ö–ª–∏–≤–æ–º—É —Å–≤—ñ—Ç—ñ ‚öì",
          "–ó —Ç–æ–±–æ—é –±—É–¥—å-—è–∫–∏–π —à–ª—è—Ö –∑–¥–∞—î—Ç—å—Å—è –ª–µ–≥—à–∏–º üö∂‚Äç‚ôÄÔ∏è",
          "–ö–æ–ª–∏ —Ç–∏ –ø–æ—Å–º—ñ—Ö–∞—î—à—Å—è, —Å–≤—ñ—Ç —Å—Ç–∞—î –∫—Ä–∞—â–∏–º üòä",
          "–ú–æ—î –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ –∑—Ä–æ—Å—Ç–∞—î —â–æ–¥–Ω—è üå±",
          "–¢–∏ ‚Äî –º–æ—è –Ω–∞–π–±—ñ–ª—å—à–∞ —Ä–∞–¥—ñ—Å—Ç—å —ñ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ üíû",
          "–Ø –≤–¥—è—á–Ω–∏–π –¥–æ–ª—ñ –∑–∞ —Ç–µ–±–µ, –º–æ—è –∫–æ—Ö–∞–Ω–∞ üíù",
          "–¢–≤–æ—î —ñ–º'—è ‚Äî –Ω–∞–π—É–ª—é–±–ª–µ–Ω—ñ—à–µ —Å–ª–æ–≤–æ –¥–ª—è –º–µ–Ω–µ üí¨",
          "–Ø –∫–æ—Ö–∞—é —Ç–µ–±–µ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ —Å—å–æ–≥–æ–¥–Ω—ñ, –∞–ª–µ –º–µ–Ω—à–µ, –Ω—ñ–∂ –∑–∞–≤—Ç—Ä–∞ üí´",
          "–¢–∏ ‚Äî –º—ñ–π –¥—ñ–º, –¥–µ –± –º–∏ –Ω–µ –±—É–ª–∏ üè°",
          "–ú–µ–Ω—ñ —Ö–æ—á–µ—Ç—å—Å—è –æ–±—ñ–π–º–∞—Ç–∏ —Ç–µ–±–µ –±–µ–∑–∫—ñ–Ω–µ—á–Ω–æ ü§ó",
          "–¢–∏ ‚Äî –º–æ—î –Ω–∞–π–∫—Ä–∞—â–µ ¬´–Ω–∞–∑–∞–≤–∂–¥–∏¬ª üåπ",
        ];

        this.createFloatingHearts();
        this.setupUI();
        this.showScreen("mainMenu");

        document.addEventListener("dblclick", (e) => e.preventDefault());
        document.addEventListener("contextmenu", (e) => e.preventDefault());
      }

      generateLevels(count) {
        const levels = [];
        let target = 64;
        let baseNumbers = [2, 4, 8];

        for (let i = 0; i < count; i++) {
          const numbers = [...baseNumbers];
          const newNumbers = this.generateNewNumbers(target);
          const xpToNext = 10 + Math.floor(i * 2.2);

          levels.push({
            target,
            numbers,
            newNumbers,
            xpToNext,
          });

          target *= 2;

          if (i % 3 === 2 && baseNumbers.length < 7) {
            baseNumbers.push(baseNumbers[baseNumbers.length - 1] * 2);
          }
        }
        return levels;
      }

      generateNewNumbers(target) {
        const arr = [];
        let num = target / 8;
        for (let i = 0; i < 8; i++) {
          if (num <= target) {
            arr.push(num);
            num *= 2;
          }
        }
        return arr;
      }

      createFloatingHearts() {
        const container = document.getElementById("floatingHearts");
        const count = 14;
        for (let i = 0; i < count; i++) {
          const h = document.createElement("div");
          h.className = "floating-heart";
          h.textContent = "‚ù§Ô∏è";
          h.style.left = Math.random() * 100 + "vw";
          h.style.top = Math.random() * 100 + "vh";
          h.style.animationDelay = Math.random() * 7 + "s";
          h.style.fontSize = 0.7 + Math.random() * 0.9 + "rem";
          container.appendChild(h);
        }
      }

      setupUI() {
        const playBtn = document.getElementById("playBtn");
        const settingsBtn = document.getElementById("settingsBtn");
        const aboutBtn = document.getElementById("aboutBtn");
        const homeBtn = document.getElementById("homeBtn");

        playBtn.addEventListener("click", () => this.startGame());
        settingsBtn.addEventListener("click", () =>
          this.showScreen("settings")
        );
        aboutBtn.addEventListener("click", () => this.showScreen("about"));

        homeBtn.addEventListener("click", () => {
          this.showScreen("mainMenu");
        });

        document
          .getElementById("backFromSettingsBtn")
          .addEventListener("click", () => {
            this.showScreen("mainMenu");
          });

        document
          .getElementById("backFromAboutBtn")
          .addEventListener("click", () => {
            this.showScreen("mainMenu");
          });

        document
          .getElementById("saveSettingsBtn")
          .addEventListener("click", () => {
            const anim = document.getElementById("animationSelect").value;
            this.animationEnabled = anim === "on";
            this.phrasesMode = document.getElementById("phrasesSelect").value;
            this.showScreen("mainMenu");
          });

        // victory buttons
        document
          .getElementById("playAgainBtn")
          .addEventListener("click", () => {
            this.hideVictory();
            this.startGame();
          });

        document
          .getElementById("backToMenuBtn")
          .addEventListener("click", () => {
            this.hideVictory();
            this.showScreen("mainMenu");
          });

        // bonuses
        document
          .getElementById("bonus-destroy")
          .addEventListener("click", () => this.activateBonus("destroy"));
        document
          .getElementById("bonus-shuffle")
          .addEventListener("click", () => this.activateBonus("shuffle"));
        document
          .getElementById("bonus-explosion")
          .addEventListener("click", () => this.activateBonus("explosion"));

        // global drag
        document.addEventListener("mousemove", (e) => this.handleMove(e));
        document.addEventListener("touchmove", (e) => this.handleMove(e), {
          passive: false,
        });
        document.addEventListener("mouseup", () => this.handleEnd());
        document.addEventListener("touchend", () => this.handleEnd());
      }

      showScreen(name) {
        document
          .querySelectorAll(".screen")
          .forEach((s) => s.classList.add("hidden"));
        const screen = document.getElementById(name + "Screen");
        if (screen) screen.classList.remove("hidden");
      }

      startGame() {
        this.initGame(0);
        this.showScreen("game");
      }

      initGame(levelIndex = 0) {
        this.currentLevel = levelIndex;
        const level = this.levels[this.currentLevel];

        this.xp = 0;
        this.xpToNext = level.xpToNext;
        this.selected = [];
        this.chainNumbers = [];
        this.gameState = "playing";
        this.activeBonus = null;

        this.grid = [];
        const minBase = this.computeMinBaseForLevel(level);

        const baseNumbers = level.numbers.filter((n) => n >= minBase);
        const pool = baseNumbers.length ? baseNumbers : level.numbers;

        for (let x = 0; x < this.GRID_W; x++) {
          this.grid[x] = [];
          for (let y = 0; y < this.GRID_H; y++) {
            this.grid[x][y] = {
              number: pool[Math.floor(Math.random() * pool.length)],
              merged: false,
            };
          }
        }

        this.updateTargetInfo();
        this.updateXPBar();
        this.updateBonusButtons();
        this.render();
      }

      computeMinBaseForLevel(level) {
        const t = level.target;
        if (t <= 256) return 2;
        if (t <= 1024) return 4;
        if (t <= 4096) return 8;
        if (t <= 16384) return 16;
        if (t <= 65536) return 32;
        return 64;
      }

      updateTargetInfo() {
        const level = this.levels[this.currentLevel];
        document.getElementById("targetValue").textContent =
          this.formatNumber(level.target);
      }

      render() {
        const gridDiv = document.getElementById("grid");
        gridDiv.innerHTML = "";

        for (let y = 0; y < this.GRID_H; y++) {
          for (let x = 0; x < this.GRID_W; x++) {
            const cellData = this.grid[x][y];

            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.x = x;
            cell.dataset.y = y;
            cell.dataset.number = cellData.number;

            if (this.selected.some((s) => s.x === x && s.y === y)) {
              cell.classList.add("selected");
            }
            if (cellData.merged) {
              cell.classList.add("merged");
            }

            const inner = document.createElement("div");
            inner.className = "cell-inner";
            inner.textContent = this.formatNumber(cellData.number);
            cell.appendChild(inner);

            cell.addEventListener("mousedown", (e) =>
              this.handleCellStart(e, x, y)
            );
            cell.addEventListener(
              "touchstart",
              (e) => this.handleCellStart(e, x, y),
              { passive: false }
            );

            gridDiv.appendChild(cell);
          }
        }
      }

      handleCellStart(e, x, y) {
        e.preventDefault();
        if (this.gameState !== "playing") return;

        if (this.activeBonus === "destroy") {
          this.useDestroyBonus(x, y);
          return;
        }
        if (this.activeBonus === "explosion") {
          this.useExplosionBonus(x, y);
          return;
        }

        if (this.isDragging) return;

        this.selected = [{ x, y }];
        this.chainNumbers = [this.grid[x][y].number];
        this.isDragging = true;

        this.updatePreviewBubble(this.getCurrentChainSum(), e);
        this.render();
      }

      handleMove(e) {
        if (!this.isDragging || this.activeBonus) return;

        const touch = e.touches ? e.touches[0] : null;
        const clientX = touch ? touch.clientX : e.clientX;
        const clientY = touch ? touch.clientY : e.clientY;
        if (clientX == null || clientY == null) return;

        e.preventDefault();

        const element = document.elementFromPoint(clientX, clientY);
        const cellEl =
          element && element.classList.contains("cell")
            ? element
            : element && element.closest(".cell");

        const pos = { clientX, clientY };

        if (!cellEl) {
          this.updatePreviewBubble(this.getCurrentChainSum(), pos);
          return;
        }

        const x = parseInt(cellEl.dataset.x, 10);
        const y = parseInt(cellEl.dataset.y, 10);

        this.handleCellHover(x, y, pos);
      }

      handleCellHover(x, y, pos) {
        if (!this.isDragging || this.activeBonus) return;

        const len = this.selected.length;
        if (len === 0) return;

        // Undo –∂–µ—Å—Ç–æ–º ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–ª–µ—Ç–∫—É
        if (len >= 2) {
          const prev = this.selected[len - 2];
          if (prev.x === x && prev.y === y) {
            this.selected.pop();
            this.chainNumbers.pop();
            this.updatePreviewBubble(this.getCurrentChainSum(), pos);
            this.render();
            return;
          }
        }

        // –£–∂–µ –≤ —Ü–µ–ø–æ—á–∫–µ?
        if (this.selected.some((s) => s.x === x && s.y === y)) {
          this.updatePreviewBubble(this.getCurrentChainSum(), pos);
          return;
        }

        const last = this.selected[len - 1];
        if (!this.isAdjacent(last, { x, y })) {
          this.updatePreviewBubble(this.getCurrentChainSum(), pos);
          return;
        }

        const newNum = this.grid[x][y].number;
        const prevNum = this.chainNumbers[this.chainNumbers.length - 1];

        // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ = –∏–ª–∏ x2
        if (newNum === prevNum || newNum === prevNum * 2) {
          this.selected.push({ x, y });
          this.chainNumbers.push(newNum);
          this.updatePreviewBubble(this.getCurrentChainSum(), pos);
          this.render();
        } else {
          this.updatePreviewBubble(this.getCurrentChainSum(), pos);
        }
      }

      handleEnd() {
        if (!this.isDragging) return;

        this.isDragging = false;
        this.hidePreviewBubble();

        if (this.selected.length >= 2) {
          this.mergeChain();
        } else {
          this.selected = [];
          this.chainNumbers = [];
          this.render();
        }
      }

      isAdjacent(a, b) {
        return Math.abs(a.x - b.x) <= 1 && Math.abs(a.y - b.y) <= 1;
      }

      getCurrentChainSum() {
        return this.chainNumbers.reduce((s, v) => s + v, 0);
      }

      mergeChain() {
        const level = this.levels[this.currentLevel];
        const sum = this.getCurrentChainSum();
        const last = this.selected[this.selected.length - 1];

        if (!this.isValidResultNumber(sum, level)) {
          this.showLoveMessage("–°–ø—Ä–æ–±—É–π —ñ–Ω—à—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é, –∫–æ—Ö–∞–Ω–∞ üíï");
          this.selected = [];
          this.chainNumbers = [];
          this.render();
          return;
        }

        this.animatePopping(() => {
          this.applyGravity(this.selected);

          // –ù–∞–π–¥—ë–º –Ω–∏–∂–Ω—é—é –∫–ª–µ—Ç–∫—É –≤ –∫–æ–ª–æ–Ω–∫–µ, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è last
          let targetY = last.y;
          while (
            targetY + 1 < this.GRID_H &&
            this.grid[last.x][targetY + 1] &&
            typeof this.grid[last.x][targetY + 1].number === "number"
          ) {
            targetY++;
          }

          this.grid[last.x][targetY].number = sum;
          this.grid[last.x][targetY].merged = true;

          const xpEarned = this.calculateXP(this.selected.length);
          this.xp += xpEarned;

          this.selected = [];
          this.chainNumbers = [];

          this.updateXPBar();
          this.updateBonusButtons();
          this.render();
          this.checkWin();
          this.showRandomLoveMessage();
        });
      }

      animatePopping(callback) {
        if (!this.animationEnabled) {
          callback();
          return;
        }
        const gridDiv = document.getElementById("grid");
        this.selected.forEach((s) => {
          const cell = gridDiv.querySelector(
            '.cell[data-x="' + s.x + '"][data-y="' + s.y + '"]'
          );
          if (cell) {
            cell.classList.add("popping");
          }
        });
        setTimeout(() => callback(), 230);
      }

      applyGravity(selectedCells) {
        const isRemoved = (x, y) =>
          selectedCells.some((c) => c.x === x && c.y === y);

        for (let x = 0; x < this.GRID_W; x++) {
          const col = [];
          for (let y = this.GRID_H - 1; y >= 0; y--) {
            if (!isRemoved(x, y)) {
              col.push(this.grid[x][y].number);
            }
          }

          const level = this.levels[this.currentLevel];
          const minBase = this.computeMinBaseForLevel(level);
          const pool = level.numbers.filter((n) => n >= minBase);
          const fillPool = pool.length ? pool : level.numbers;

          while (col.length < this.GRID_H) {
            col.push(fillPool[Math.floor(Math.random() * fillPool.length)]);
          }

          let idx = 0;
          for (let y = this.GRID_H - 1; y >= 0; y--) {
            this.grid[x][y] = { number: col[idx++], merged: false };
          }
        }
      }

      isValidResultNumber(num, level) {
        return level.numbers.includes(num) || level.newNumbers.includes(num);
      }

      calculateXP(len) {
        if (len === 2) return 1;
        if (len === 3) return 4;
        if (len === 4) return 8;
        if (len === 5) return 15;
        if (len >= 6) return 25;
        return 0;
      }

      updateXPBar() {
        const percent = Math.min(1, this.xp / this.xpToNext);
        const bar = document.getElementById("xpBar");
        const txt = document.getElementById("xpText");
        bar.style.width = percent * 100 + "%";
        txt.textContent = this.xp + "/" + this.xpToNext;
      }

      activateBonus(type) {
        if (this.activeBonus === type) {
          this.activeBonus = null;
          this.updateBonusButtons();
          return;
        }

        const cost = this.bonusCosts[type];
        if (this.xp < cost) {
          this.showLoveMessage(
            "–¢—Ä—ñ—à–∫–∏ –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î –æ—á–∫—ñ–≤ –∫–æ—Ö–∞–Ω–Ω—è, –¥–∞–≤–∞–π —â–µ —Ç—Ä—ñ—à–∫–∏ üå∏"
          );
          return;
        }

        if (type === "shuffle") {
          this.xp -= cost;
          this.shuffleGrid();
          this.updateXPBar();
          this.updateBonusButtons();
          this.showLoveMessage("–ü–æ–ª–µ –ø–µ—Ä–µ–º—ñ—à–∞–Ω–æ –∑ –ª—é–±–æ–≤'—é üí´");
          return;
        }

        this.activeBonus = type;
        this.updateBonusButtons();
        this.showLoveMessage("–û–±–µ—Ä–∏ –∫–ª—ñ—Ç–∏–Ω–∫—É –¥–ª—è –±–æ–Ω—É—Å—É, –∫–æ—Ö–∞–Ω–∞ ‚ú®");
      }

      shuffleGrid() {
        const all = [];
        for (let x = 0; x < this.GRID_W; x++) {
          for (let y = 0; y < this.GRID_H; y++) {
            all.push(this.grid[x][y].number);
          }
        }
        for (let i = all.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [all[i], all[j]] = [all[j], all[i]];
        }
        let k = 0;
        for (let x = 0; x < this.GRID_W; x++) {
          for (let y = 0; y < this.GRID_H; y++) {
            this.grid[x][y].number = all[k++];
            this.grid[x][y].merged = false;
          }
        }
        this.render();
      }

      useDestroyBonus(x, y) {
        const level = this.levels[this.currentLevel];
        const minBase = this.computeMinBaseForLevel(level);
        const pool = level.numbers.filter((n) => n >= minBase);
        const fillPool = pool.length ? pool : level.numbers;

        this.grid[x][y].number =
          fillPool[Math.floor(Math.random() * fillPool.length)];
        this.xp -= this.bonusCosts.destroy;
        this.activeBonus = null;
        this.updateXPBar();
        this.updateBonusButtons();
        this.render();
        this.showLoveMessage("–ú–∏ –æ–Ω–æ–≤–∏–ª–∏ —Ü—é –∫–ª—ñ—Ç–∏–Ω–∫—É –∑ –ª—é–±–æ–≤'—é üíñ");
      }

      useExplosionBonus(x, y) {
        const level = this.levels[this.currentLevel];
        const minBase = this.computeMinBaseForLevel(level);
        const pool = level.numbers.filter((n) => n >= minBase);
        const fillPool = pool.length ? pool : level.numbers;

        for (let dx = -1; dx <= 1; dx++) {
          for (let dy = -1; dy <= 1; dy++) {
            const nx = x + dx;
            const ny = y + dy;
            if (
              nx >= 0 &&
              nx < this.GRID_W &&
              ny >= 0 &&
              ny < this.GRID_H
            ) {
              this.grid[nx][ny].number =
                fillPool[Math.floor(Math.random() * fillPool.length)];
            }
          }
        }

        this.xp -= this.bonusCosts.explosion;
        this.activeBonus = null;
        this.updateXPBar();
        this.updateBonusButtons();
        this.render();
        this.showLoveMessage("–ù–µ–≤–µ–ª–∏—á–∫–∏–π –≤–∏–±—É—Ö –∫–æ—Ö–∞–Ω–Ω—è üí•‚ù§Ô∏è");
      }

      updateBonusButtons() {
        ["destroy", "shuffle", "explosion"].forEach((type) => {
          const btn = document.getElementById("bonus-" + type);
          const cost = this.bonusCosts[type];
          btn.classList.toggle("active", this.activeBonus === type);
          btn.disabled = this.xp < cost && this.activeBonus !== type;
        });
      }

      checkWin() {
        const level = this.levels[this.currentLevel];
        for (let x = 0; x < this.GRID_W; x++) {
          for (let y = 0; y < this.GRID_H; y++) {
            if (this.grid[x][y].number === level.target) {
              this.gameState = "win";
              this.showLoveMessage(
                "–¢–∏ –¥–æ—Å—è–≥–ª–∞ —Ü—ñ–ª—ñ " +
                  this.formatNumber(level.target) +
                  " üéâ"
              );
              this.autoNextLevel();
              return;
            }
          }
        }

        if (this.xp >= this.xpToNext) {
          this.showLoveMessage("–¢–∏ –≥–æ—Ç–æ–≤–∞ –¥–æ –Ω–æ–≤–æ–≥–æ —Ä—ñ–≤–Ω—è –Ω–∞—à–æ–≥–æ –∫–æ—Ö–∞–Ω–Ω—è üíñ");
        }
      }

      autoNextLevel() {
        if (this.currentLevel < this.MAX_LEVEL - 1) {
          setTimeout(() => {
            this.currentLevel++;
            this.initGame(this.currentLevel);
            this.showLoveMessage(
              "–ù–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å, –Ω–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –Ω–∞—à–æ–≥–æ –∫–æ—Ö–∞–Ω–Ω—è üåü"
            );
          }, 900);
        } else {
          setTimeout(() => this.showVictory(), 1000);
        }
      }

      showVictory() {
        const overlay = document.getElementById("victoryOverlay");
        overlay.classList.remove("hidden");
      }

      hideVictory() {
        const overlay = document.getElementById("victoryOverlay");
        overlay.classList.add("hidden");
      }

      showRandomLoveMessage() {
        let msg;
        if (this.phrasesMode === "more") {
          msg =
            this.loveMessages[
              Math.floor(Math.random() * this.loveMessages.length)
            ];
        } else {
          if (Math.random() < 0.4) {
            msg = "–¢–∏ —á—É–¥–æ–≤–æ —Å–ø—Ä–∞–≤–ª—è—î—à—Å—è, –∫–æ—Ö–∞–Ω–∞ üíï";
          } else {
            msg =
              this.loveMessages[
                Math.floor(Math.random() * this.loveMessages.length)
              ];
          }
        }
        this.showLoveMessage(msg);
      }

      showLoveMessage(text) {
        const container = document.querySelector(
          "#gameScreen .grid-container"
        );
        if (!container) return;

        const bubble = document.createElement("div");
        bubble.className = "love-bubble";

        const left = 15 + Math.random() * 70;
        const top = 20 + Math.random() * 60;
        bubble.style.left = left + "%";
        bubble.style.top = top + "%";
        bubble.textContent = text;

        container.appendChild(bubble);
        setTimeout(() => bubble.remove(), 1900);
      }

      updatePreviewBubble(sum, pos) {
        const bubble = document.getElementById("previewBubble");
        if (!bubble) return;
        bubble.textContent = "= " + this.formatNumber(sum);

        if (pos && pos.clientX != null) {
          const rect = document
            .querySelector(".grid-container")
            .getBoundingClientRect();
          const x = pos.clientX - rect.left;
          const y = pos.clientY - rect.top;
          bubble.style.left = x + "px";
          bubble.style.top = y + "px";
        }

        bubble.style.opacity = sum > 0 ? "1" : "0";
      }

      hidePreviewBubble() {
        const bubble = document.getElementById("previewBubble");
        if (!bubble) return;
        bubble.style.opacity = "0";
      }

      formatNumber(num) {
        if (num >= 1_000_000)
          return (num / 1_000_000).toFixed(1).replace(".0", "") + "M";
        if (num >= 10_000) return (num / 1_000).toFixed(0) + "–ö";
        if (num >= 1_000)
          return (num / 1_000).toFixed(1).replace(".0", "") + "–ö";
        return num;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      new LoveNumberPuzzle();
    });
  </script>
</body>
</html>
